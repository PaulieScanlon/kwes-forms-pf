---
import Main from '../layouts/main.astro';
import { groupByTime } from '../utils/group-by-time';
import { groupByExperience } from '../utils/group-by-experience';
import { groupByTechnology } from '../utils/group-by-technology';

const response = await fetch('https://kwes.io/api/v1/forms/5689/submissions?mode=production', {
  method: 'GET',
  headers: {
    Accept: 'application/json',
    'Content-Type': 'application/json',
    Authorization: 'Bearer gwEvpqTVnGDA4s5vOHeIAcOxSO566jXZ5EPjfFjWWuXThX61CHlg5I8J4Wwt',
  },
  redirect: 'follow',
});

const data = await response.json();

const byTime = groupByTime(data);
const byExperience = groupByExperience(data);
const byTechnology = groupByTechnology(data);
---

<Main>
  <p class='mt-0 mb-16'>Results of the survey so far.</p>
  <h2>Time</h2>
  <pre>{JSON.stringify(byTime, null, 2)}</pre>
  <h2>Experience</h2>
  <pre>{JSON.stringify(byExperience, null, 2)}</pre>
  <h2>Technology</h2>
  <pre>{JSON.stringify(byTechnology, null, 2)}</pre>
</Main>
